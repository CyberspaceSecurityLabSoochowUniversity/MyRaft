## MyRaft
---
#### 2021/2/21 星期日
1. 准备将start函数代码分为三个部分编写（分别对应Follower,Candidate,Leader），在Server.go中新写了一个loop函数，并在Server.go的Start函数中调用loop函数，今日将Follower部分写好了。但是发现在投票的时候需要考虑当前任期内是否投过票，所以需要在Server中再加一个变量表示投票的任期用于解决这个问题（哪个任期投了票就把这个变量的值设为这个任期，投票时看投票任期是否与当前任期一致，一致则代表当前任期已经投过票，不一致则可以投票，初始投票任期为0），该部分今日已完成。
2. 在写Follower部分代码时发现当节点需要主动发送数据请求时则需要利用通道技术，可以循环的取通道的值，一旦通道中出现值则就发起数据请求，而通道中放入值则就需要根据具体情况进行编写（比如说一个新的节点添加对等点请求则就在告诉入口节点并同意加入集群之后就往通道中加入值）。
3. 关于对等点加入与删除问题：一个新启动的节点在启动后会主动发起添加对等点请求，在关闭之前会主动发起请求告诉集群中节点删除对等点信息。

+ FollowerLoop函数中未完成工作：添加对等点请求
+ Server的Stop函数中未完成工作：删除对等点请求
---
#### 2021/2/22 星期一

1. CandidateLoop代码完成
2. CandidateLoop中还需要考虑投票的时间（因为当两个以上候选者平分投票，则谁也无法获得超过集群一半的票数，则会不停的等待，当超过投票的时间，设为Follower状态）
3. CandidateLoop中若收到领导者的心跳信息则应该主动设为Follower状态

+ FollowerLoop、CandidateLoop、LeaderLoop中都需要考虑服务器突然下线的情况，以及下线需要做哪些处理
+ FollowerLoop、CandidateLoop中若收到心跳中的日志索引小于自身的索引则是否需要将日志与领导者保持一致？
---
#### 2021/2/23 星期二

1. LeaderLoop代码完成
2. Follower、Candidater、Leader中都得考虑接收到投票的请求，代码中通过一个vote()函数解决
3. 客户端发送给Leader的添加日志请求先写为key,value形式，这样后期如果需要修改也好修改

+ 客户端添加日志请求通过广播形式发给集群中节点，到底时所有节点（所有节点都接收则如果不是leader需要转发这个添加请求给leader）只有Leader接收呢