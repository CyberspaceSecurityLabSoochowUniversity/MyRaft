## MyRaft
---
#### 2021/2/21 星期日
1. 准备将start函数代码分为三个部分编写（分别对应Follower,Candidate,Leader），在Server.go中新写了一个loop函数，并在Server.go的Start函数中调用loop函数，今日将Follower部分写好了。但是发现在投票的时候需要考虑当前任期内是否投过票，所以需要在Server中再加一个变量表示投票的任期用于解决这个问题（哪个任期投了票就把这个变量的值设为这个任期，投票时看投票任期是否与当前任期一致，一致则代表当前任期已经投过票，不一致则可以投票，初始投票任期为0），该部分今日已完成。
2. 在写Follower部分代码时发现当节点需要主动发送数据请求时则需要利用通道技术，可以循环的取通道的值，一旦通道中出现值则就发起数据请求，而通道中放入值则就需要根据具体情况进行编写（比如说一个新的节点添加对等点请求则就在告诉入口节点并同意加入集群之后就往通道中加入值）。
3. 关于对等点加入与删除问题：一个新启动的节点在启动后会主动发起添加对等点请求，在关闭之前会主动发起请求告诉集群中节点删除对等点信息。

+ FollowerLoop函数中未完成工作：添加对等点请求
+ Server的Stop函数中未完成工作：删除对等点请求
---
#### 2021/2/22 星期一

1. CandidateLoop代码完成
2. CandidateLoop中还需要考虑投票的时间（因为当两个以上候选者平分投票，则谁也无法获得超过集群一半的票数，则会不停的等待，当超过投票的时间，设为Follower状态）
3. CandidateLoop中若收到领导者的心跳信息则应该主动设为Follower状态

+ FollowerLoop、CandidateLoop、LeaderLoop中都需要考虑服务器突然下线的情况，以及下线需要做哪些处理？
+ FollowerLoop、CandidateLoop中若收到心跳中的日志索引小于自身的索引则是否需要将日志与领导者保持一致（网络分区）？
---
#### 2021/2/23 星期二

1. LeaderLoop代码完成
2. Follower、Candidater、Leader中都得考虑接收到投票的请求，代码中通过一个vote()函数解决
3. 客户端发送给Leader的添加日志请求先写为key,value形式，这样后期如果需要修改也好修改

+ 客户端添加日志请求通过广播形式发给集群中节点，到底是所有节点（所有节点都接收则如果不是leader需要转发这个添加请求给leader）还是只有Leader接收呢

---

#### 2021/2/24 星期三

1. 在添加对等点的时候，如果集群中节点收到添加对等点请求后自己也发送一个添加对等点请求给发送这个请求的节点，这样两者就都能添加对等点了
2. 添加对等点时，如果是leader接收到这个请求，则需要告诉新加入的节点立即开始心跳，如果是candidater接收到这个请求，则需要告诉新加入的节点立即开始投票

+ 入口节点，也可以称为元服务器（功能：所有节点的信息可以查看，可以管理节点的上线与下线，负责新节点的加入）是否应该独立于集群之外or也是集群中的一个节点（但是不参与集群运转）？
+ 集群中节点下线存在两种情况：一种是入口节点向集群中节点发起下线请求（主动），另一种是节点由于断电、程序出错等方式突然下线（被动）。第一种方式下线比较容易解决，第二种方式下线该如何让集群中其他节点知道这个节点已经下线了呢？

---

#### 2021/2/25 星期四

1. 集群中节点主动下线时，需要考虑删除对等点和关闭日志
2. 当Follower投票后应该将Follower的CurrentTerm+1，这样一旦当前任期无法选出Leader，Follower在超时后会CurrentTerm+1后发起新的一轮投票，就不会造成长时间无法选出Leader的情况

+ 集群中节点主动下线时，除了考虑删除对等点和关闭日志，是否还需要针对不同节点的状态进行不同的关闭操作（Candidate的投票不会再继续收集，Leader的心跳也不会再发送，好像也不太需要其他操作了，可能是我想多了）？
+ 接下来工作的难点：入口节点（元服务器）如何完成代码编写，集群中节点被动下线情况如何解决，日志部分的存储与利用，快照和状态机的实现